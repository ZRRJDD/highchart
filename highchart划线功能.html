<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
<link rel="icon" href="https://static.jianshukeji.com/highcharts/images/favicon.ico">
<meta name="viewport" content="width=device-width, initial-scale=1">	<script src="https://img.hcharts.cn/jquery/jquery-1.8.3.min.js"></script>
	<script src="https://img.hcharts.cn/highstock/highstock.js"></script>
	<script src="https://img.hcharts.cn/highcharts/modules/exporting.js"></script>
	<script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>
</head>
<body>
<!--
*************************************************************************
   Generated by HCODE at 2017-08-14 13:33:14
   From: https://code.hcharts.cn/temp/hBOl1G/1
*************************************************************************
 -->
	<div id="container" style="min-width:400px;height:400px"></div>
<input type="button" value="删除上一条线" onclick="hiddenLine();" />

	<script>
	var groups = [];
$(function () {
    $.getJSON('https://data.jianshukeji.com/jsonp?filename=json/aapl-c.json&callback=?', function (data) {
        var x = '';
        var y = '';
        var line;
        $('#container').highcharts('StockChart', {
            chart: {
                events: {
                    click: function (event) {
                        var group = this.renderer.g().add();
                        if(x !== '' && y !== '' &&groups.length %2 == 1){
                            line =   this.renderer.path(['M', x, y, 'L', event.chartX, event.chartY])
                                .attr({
                                'stroke-width': 1,
                                stroke: 'red'
                            }).add(group) ;
                            line.toFront({
                                zIndex:1
                            });
                            x = event.chartX;
                            y = event.chartY;
                        }else{
                            x = event.chartX;
                            y = event.chartY;
                        }
                        this.renderer.circle(x, y, 1).attr({
                            fill: '#FCFFC5',
                            stroke: 'black',
                            'stroke-width': 1
                        }).add(group);
                        if(groups.length %2 == 1){
                            x = '';
                            y = '';
                        }
                        groups.push(group);
                    }
                }
            },
            rangeSelector : {
                selected : 5
            },
            title : {
                text : '苹果历史股价（股票代码：AAPL）'
            },
            series : [{
                name : 'AAPL',
                data : data,
                tooltip: {
                    valueDecimals: 2
                }
            }]
        });
    });
});
function hiddenLine(){
    console.log(groups);
    if(groups.length > 0){
        if(groups.length % 2 === 0){
            for(var i=0;i<2;i++){
                groups.pop().hide();
            }
        }else{
            groups.pop().hide();
        }
    }
}
</script>
</body>
</html>